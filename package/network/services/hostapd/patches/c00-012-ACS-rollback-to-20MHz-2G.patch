From 6653fa0a65d0829492b0f5c3107f4984df092571 Mon Sep 17 00:00:00 2001
From: Aloka Dixit <alokad@codeaurora.org>
Date: Fri, 3 Jan 2020 10:45:11 -0800
Subject: [PATCH] Hostapd: Roll back from 40MHz to 20MHz for 2.4GHz in case of
 overlapping BSS after ACS.

Signed-off-by: Aloka Dixit <alokad@codeaurora.org>
---
 src/common/hw_features_common.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/src/common/hw_features_common.c b/src/common/hw_features_common.c
index 0e2225f1ea24..b621fafeb21b 100644
--- a/src/common/hw_features_common.c
+++ b/src/common/hw_features_common.c
@@ -98,7 +98,12 @@ int allowed_ht40_channel_pair(struct hostapd_hw_modes *mode, int pri_chan,
 	if (!p_chan)
 		return 0;
 
-	if (pri_chan == sec_chan || !sec_chan) {
+	/* If primary and secondary channels are set to same value,
+	 * operating width should be changed to 20MHz. */
+	if (pri_chan == sec_chan)
+		return 0;
+
+	if (!sec_chan) {
 		if (chan_pri_allowed(p_chan))
 			return 1; /* HT40 not used */
 
-- 
2.7.4

